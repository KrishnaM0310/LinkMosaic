<!DOCTYPE html>
<html>
<head>
  <title>LinkMosaic Uploader</title>
  <meta charset="utf-8" />
  <style>
    body { font-family: Arial; text-align: center; background: #111; color: #fff; }
    #map { margin-top: 20px; white-space: pre-wrap; text-align: left; }
    input[type=file] { margin: 20px; }
  </style>
</head>
<body>
  <h1>ðŸ§  LinkMosaic</h1>
  <p>Upload a PDF or TXT file to generate your knowledge map.</p>

  <input type="file" id="fileInput" accept=".pdf,.txt" />
  <button id="uploadBtn">Upload & Generate Map</button>

  <div id="status"></div>
  <pre id="map"></pre>

  <script>
    const UPLOAD_API = "https://nq4pabxyn7.execute-api.us-east-2.amazonaws.com"; // ðŸ”¹ replace with your real API Gateway URL
    const MAP_URL = "https://linkmosaic-maps-krishnamehta.s3.us-east-2.amazonaws.com/maps/latest_map.json";

    document.getElementById("uploadBtn").onclick = async () => {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("Please select a file first!");

      document.getElementById("status").innerText = "Requesting upload link...";
      const res = await fetch(UPLOAD_API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ filename: file.name })
      });
      const { upload_url, key } = await res.json();

      document.getElementById("status").innerText = "Uploading file...";
      await fetch(upload_url, { method: "PUT", body: file });

      document.getElementById("status").innerText = "Processing on AWS...";
      await new Promise(r => setTimeout(r, 10000)); // wait 10s for Lambda pipeline

      const mapResp = await fetch(MAP_URL);
      const mapData = await mapResp.json();

      document.getElementById("status").innerText = "âœ… Map generated!";
      document.getElementById("map").innerText = JSON.stringify(mapData, null, 2);
    };
  </script>
</body>
</html>
